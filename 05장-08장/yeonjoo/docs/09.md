# 9. 단위 테스트

## TDD법칙 세 가지

- TDD는 실제 코드를 짜기 전에 단위 테스트부터 작성하라 요구한다는 사실
- 법칙
    1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다
    2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다
    3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다
- 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 함

## 깨끗한 테스트 코드 유지하기

- 실제 코드가 진화하면 테스트 코드도 변해야 함
- 테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸리기 십상임
    - 실제 코드를 변경해 기존 테스트 케이스가 실패하기 시작하면, 지저분한 코드로 인해, 실패하는 테스트 케이스를 점점 더 통과시키기 어려워짐
    - 테스트 코드는 계속해서 늘어나는 부담이 되버림
- 새 버전을 출시할 때마다 팀이 테스트 케이스를 유지하고 보수하는 비용도 늘어남 → 테스트 슈트를 버려야 하는 상황에 처함
- 테스트 슈트가 없으면 개발자는 수정한 코드가 제대로 도는지 확인할 방법이 없음 → 결함률이 높아짐 → 개발자는 변경을 주저함 → 코드가 망가지기 시작 → 좌절한 고객사 → 테스트 원망
- 깨끗한 단위 테스트 코드는 결과가 좋음 (위와 같은 상황을 일으키지 않음)

### 테스트는 유연성, 유지보수성, 재사용성을 제공함

- 단위 테스트는 코드에 유연성, 유지보수성, 재사용성을 제공함
- 테스트 커버리지가 높을수록 개발자가 코드 수정에 대한 공포가 줄어듦
- 테스트 코드가 지저분할수록 실제 코드도 지저분해짐

## 깨끗한 테스트 코드

- 깨끗한 테스트 코드는 “가독성”이 중요함
- 명료성, 단순성, 풍부한 표현력이 필요함
- 테스트 코드는 최소의 표현으로 많은 것을 나타내야 함
- BUILD-OPERATE-CHECK 패턴이 위와 같은 테스트 구조에 적합함
- 테스트 코드는 본론에 돌입해 진짜 필요한 자료 유형과 함수만 사용함 → 코드가 수행하는 기능을 재빨리 이해 가능

### 도메인에 특화된 테스트 언어

- 도메인에 특화된 언어 (DSL)
    - 시스템 조작 API 위에 함수와 유틸리티를 구현하여 사용하기 때문에, 테스트 코드를 짜기도 읽기도 쉬워짐
    - 테스트 코드에서 사용하는 특수 API가 됨
    - 테스트를 구현하는 당사자와 나중에 테스트를 읽어볼 독자를 도와주는 테스트 언어
- 테스트 API는 처음부터 설계된 API가 아니라 계속 리팩터링하다가 진화 된 것임

### 이중 표준

- 실제 환경이 아닌 테스트 환경에서 돌아가는 코드이기 때문에, 단순하고 간결하고 표현력이 풍부해야 하지만, 실제 코드만큼 효율적일 필요는 없음
- 이중 표준의 본질
    - 실제 환경에선느 절대로 안 되지만 테스트 환경에서는 전혀 문제 없는 방식이 있음
    - 대개 메모리나 CPU 효율과 관련 있는 경우임
    - 코드의 깨끗함과는 철저히 무관함
    - 예시, StringBuffer를 실제 코드에서는 피하지만 테스트 환경에서는 사용할 수 잇음

## 테스트 당 assert 하나

- assert 문이 단 하나인 함수는 결론이 하나라 코드를 이해하기 쉽고 빠름
- given-when-then 관례 사용 → 테스트 코드를 읽기가 쉬워짐
- 테스트를 분리하면 중복되는 코드가 많아짐
    - TEMPLATE METHOD 패턴을 사용하여 중복을 제거 가능
- 상황에 따라 함수 하나에 assert 여러 개 넣기도 하지만 최대한으로 줄여야 좋음

### 테스트 당 개념 하나

- “테스트 함수마다 한 개념만 테스트 하라”

## F.I.R.S.T

### Fast (빠르게)

- 테스트는 빨리 돌아야 함
- 느리면 → 자주 돌리지 않음 → 초반에 문제를 찾아내지 못함 → 코드를 마음껏 정리 못함 → 코드 품질이 망가짐

### Independent (독립적인)

- 각 테스트는 서로 의존하면 안 됨
- 어떤 순서로 실행해도 테스트는 성공해야 함

### Repeatable (반복가능하게)

- 테스트는 어떤 환경에서도 수행 가능함

### Self-Validating (자가검증하는)

- 테스트는 boolean 값으로 결과를 내야 함 (성공 아님 실패)

### Timely (적시에)

- 테스트는 적시에 작성해야함
- 실제 코드를 구현한 후 테스트 코드를 만들면 실제 코드가 테스트하기 어렵다는 사실을 발견할지도 모름

## 결론

- 테스트 코드를 깨끗하게 유지하자
- 테스트 코드가 망가지면 실제 코드도 망가진다
- 테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화
- 테스트 코드는 지속적으로 깨끗하게 관리하고, 표현력을 높이고 간결하게 정리하자. 그리고 테스트 API를 구현해 도메인 특화 언어 (Domain Specific Language, DSL)을 만들자 → 테스트 코드를 작성하기 쉬워짐